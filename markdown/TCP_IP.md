# TCP/IP 簡介

TCP/IP（傳輸控制協定 / 網際協定）是一組用於網路通訊的協定，是網際網路的核心。

## 四層架構模型

| 層級 | 名稱 | 功能說明 | 實例 |
|------|------|----------|------|
| 第四層 | 應用層 | 提供使用者與網路的互動 | HTTP, FTP, SMTP |
| 第三層 | 傳輸層 | 資料傳輸與可靠性保障 | TCP, UDP |
| 第二層 | 網際層 | 選擇傳輸路徑與 IP 定位 | IP, ICMP |
| 第一層 | 網路介面層 | 實體資料傳送 | Ethernet, Wi-Fi |

## TCP vs UDP

| 協定 | 特性 | 使用情境 |
|------|------|----------|
| TCP | 有連線、可靠、順序保證 | 網頁、Email |
| UDP | 無連線、快速但不保證 | 影音串流、遊戲 |

## TCP 三次握手流程（建立連線）

1. Client → Server：SYN
2. Server → Client：SYN-ACK
3. Client → Server：ACK

    ```plaintext
    Client                              Server
    |                                   |
    | -------- SYN(seq = x) ----------> | ① 請求建立連線
    |                                   |
    | <----- SYN-ACK(seq = y, ack = x+1) | ② 同意並回應
    |                                   |
    | -------- ACK(ack = y+1) --------> | ③ 確認收到，連線建立
    |                                   |
    ```
   
   ### 詳細說明：

    #### 第一次握手：
    - Client 傳送一個封包，**SYN=1，Seq=x**
    - 表示：我想建立連線，這是我的初始序號 x。

    #### 第二次握手：
    - Server 收到後，回應封包：**SYN=1，ACK=1，Seq=y，Ack=x+1**
    - 表示：我願意建立連線，我的序號是 y，我知道你是 x。

    #### 第三次握手：
    - Client 再回應封包：**ACK=1，Seq=x+1，Ack=y+1**
    - 表示：我知道你的序號是 y，現在我們可以開始傳資料。

    ### ✅ 完成後：
    - 雙方連線狀態為 **ESTABLISHED**

## TCP 四次揮手流程（結束連線）

1. Client：FIN
2. Server：ACK
3. Server：FIN
4. Client：ACK
   
   ```plaintext
    Client                              Server
    |                                   |
    | -------- FIN(seq = u) ----------> | ① 我傳送完了，不再發資料
    |                                   |
    | <-------- ACK(ack = u+1) -------- | ② 我知道了，但我還有資料
    |                                   |
    | <-------- FIN(seq = v) ---------- | ③ 我也傳完了，不再發資料
    |                                   |
    | -------- ACK(ack = v+1) --------> | ④ 我知道了，雙方可關閉
    |                                   |
    ``` 
    ###  詳細說明：

     #### 第一次揮手：
     - Client 傳送封包：**FIN=1，Seq=u**
     - 表示：我沒資料要傳了，請關閉我這端的傳送功能。

     #### 第二次揮手：
     - Server 回應封包：**ACK=1，Ack=u+1**
     - 表示：我知道了，但我還有資料要傳。

     #### 第三次揮手：
     - Server 傳送封包：**FIN=1，Seq=v**
     - 表示：我也傳完資料了，請你斷線。

     #### 第四次揮手：
     - Client 回應封包：**ACK=1，Ack=v+1**
     - 表示：我知道你也沒資料了，雙方都可以斷線。

    ### 🔁 TIME_WAIT 狀態（在第四步後）：

    Client 會短暫保留連線一段時間（預設 2 倍最大封包壽命時間），以確保 Server 收到最後 ACK，避免封包延遲重傳錯誤。

    ### ✅ 完成後：
    - 雙方連線狀態為 **CLOSED**